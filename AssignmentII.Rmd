---
title: "Advanced Topics in Regression - Assignment II"
author: "Roger Bukuru"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question 1

## (a)

## b 

### i

```{r}
library(ggplot2)
library(tidyverse)
library(dplyr)

rm(list = ls())
filepath = "data/tempexam.csv"
temp_data = read.csv2(filepath)
summary(temp_data)

# Nadayara-Watson function
gaussian_kernel = function(x,h){
  return ((1/sqrt(2*pi*(h^2))) * exp(-0.5*(x/h)^2))
}

nw_estimator = function(x, observed_x, observed_y, h){
 weights = sapply(observed_x, function(xi) gaussian_kernel(abs(x-xi), h))
 weights = weights/sum(weights) # normalize weights
 y_hat = sum(weights * observed_y)
 return (y_hat)
}

x_train = as.matrix(temp_data$Dates)
y_train = as.matrix(as.numeric(temp_data$y))

y_hat = sapply(x_train, nw_estimator,observed_x = x_train, observed_y = y_train, 0.5)
final_temp_data = data.frame(x= x_train, y = y_train, y_hat=y_hat)

# Plot Nadayara-Watson estimators against the original data
ggplot(final_temp_data, aes(x = x, y = y)) +
  geom_line(color = "blue") +
  geom_line(aes(y = y_hat), color = "red") +
  labs(title = "Nadaraya-Watson Regression Smoothing",
       x = "Year",
       y = "Temperature")
```

### ii

```{r}
# Leave one-out-cross-validation

loo_cv = function(data){
  cv_grid = matrix(data=NA, nrow=nrow(data), ncol = 31)
 for (i in 1:nrow(data)){
   training_set = data[-i, ]
   validation_set = data[i, ]
   x_train = as.matrix(data$Dates)
   y_train = as.matrix(as.numeric(data$y))
   x_validation = as.matrix(validation_set$Dates)
   cv_grid[i,1] = x_validation
   for( h in 2:31){
     y_hat = sapply(x_validation, nw_estimator,observed_x = x_train, observed_y = y_train, h)
     cv_grid[i,h] = y_hat
   }
 }
 colnames(cv_grid) = c("x", paste0("h", 1:30))
 return (cv_grid)
}

cv_results = loo_cv(temp_data)

```